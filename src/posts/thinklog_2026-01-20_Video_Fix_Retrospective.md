# 📅 复盘：视频库治理与挂载“虚惊”事件

> **日期**: 2026-01-20
> **关键词**: FFmpeg, PowerShell, Rclone, 缓存风暴, 系统环境变量

## 1. 🎬 背景：视频库的批量治理
为了解决 HLS 下载视频的播放兼容性及文件名污染问题，昨日执行了一次大规模的媒体库维护。

### 核心变更
*   **流式播放修复 (`moov` 移动)**
    *   **问题**: MP4 文件的 `moov atom` 位于文件尾部，导致播放器必须下载完整个文件才能开始播放。
    *   **方案**: 部署 FFmpeg (n6.1.2) 并配置全局 PATH，编写 `fix-videos.ps1` 脚本批量执行 `-movflags faststart`。
*   **元数据清洗**
    *   **问题**: 大量文件包含推广后缀（如 `- 好色™ Tv`）。
    *   **方案**: 使用 `rename-files.ps1` 对 697 个文件进行了原子化重命名。

### 成果
成功清洗并修复了约 **700+** 个视频文件，显著提升了库的整洁度与加载速度。

---

## 2. 🔍 异常：挂载盘的“红叉”警告
今晨（01-20）系统启动后，发现 Dropbox 和 PikPak 的本地挂载点（Switch）在资源管理器中显示红叉（断开状态）。

### 假设验证
*   **假设 A**: 昨日修改系统环境变量（添加 FFmpeg）时意外破坏了系统路径，导致 FUSE/Dockany 驱动加载失败。
    *   **验证**: 检查 `$env:Path`，确认 `Windows\System32` 等核心路径完好无损。**[排除]**
*   **假设 B**: 批量文件操作引发了挂载服务的缓存压力。
    *   **验证**: 检查发现挂载服务实际上正在运行，磁盘属性显示正常 (`FUSE-rclone`)，仅 UI 响应超时。**[确认]**

## 3. 💡 深度分析：缓存风暴与挂载机制
通过分析确认，这次“故障”实际上是一次**机制层面的正常拥塞**。

### 为什么会显示红叉？
1.  **大规模变更积压**: 昨日的脚本瞬间修改了 700 多个文件的元数据（文件名是元数据的一部分）。
2.  **启动时校验 (Startup Scrubbing)**: Rclone 启动时需要扫描本地通过 `E:\RcloneCache` 缓存的变更，并与云端状态进行比对。
3.  **资源管理器超时**: Windows Explorer 在启动初期尝试连接 H 盘，但此时 Rclone 正忙于高强度的 IO 校验（处理那几千个变更记录），未能及时响应“握手”请求，于是 Explorer 标记其为“断开”。
4.  **自动恢复**: 一旦 Rclone 完成了缓存索引的重建（Digest），挂载点随即恢复正常读写。

## 4. 🛡️ 架构验证
虽然是一场虚惊，但验证了当前系统架构的健壮性：
*   **系统底层稳定性**: 证明了 FFmpeg 的全局部署与挂载驱动（FUSE）在进程空间上是严格隔离的，互不干扰。
*   **最佳实践验证**: 将 Rclone 缓存独立设置在 `E:\RcloneCache` 是极佳的决策。这确保了在发生此类“缓存风暴”时，高强度的 IO 争用被限制在数据盘（E盘），保护了系统盘（C盘）的流畅运行。

## 5. ✅ 结论
本次事件并非故障，而是系统在处理大规模数据一致性时的**自我修复过程**。视频库治理操作是安全的，当前的挂载与缓存策略是经得起考验的。
